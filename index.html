<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SmartStop VIT</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
    <style>
        /* Modal fix implemented below your original CSS: */
        .modal {
            background: rgba(0, 0, 0, .5);
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            /* Remove margin, padding, font-size inheritance */
            margin: 0;
            padding: 0;
        }

        .modal-content {
            background: white;
            padding: 2em;
            border-radius: 8px;
            text-align: center;
            max-width: 95vw;
            min-width: 320px;
            box-shadow: 0 8px 38px rgba(44, 62, 80, 0.15);
            position: relative;
            margin: 0 auto;
        }

        /* ...place additional style upgrades from previous assistant message here... */
        .loader {
            display: inline-block;
            width: 44px;
            height: 44px;
        }

        .loader:after {
            content: " ";
            display: block;
            width: 32px;
            height: 32px;
            margin: 6px;
            border-radius: 50%;
            border: 6px solid #0062cc;
            border-color: #0062cc transparent #0062cc transparent;
            animation: loader-spin 1.2s linear infinite;
        }

        @keyframes loader-spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ...all your other .bus-status, .auto-card, .snackbar, @media, etc. ... */
    </style>
</head>

<body>
    <header>
        <!-- <button id="darkModeSwitch" class="dark-toggle-btn"><i class="fas fa-moon"></i> Dark Mode</button> -->
        <h1><i class="fas fa-bus"></i> SmartStop VIT</h1>
        <p>Your campus commute, tracked and timed to perfection.</p>
        <nav class="main-nav">
            <a href="/" class="nav-link active"><i class="fas fa-home"></i> Home</a>
            <a href="/analytics" class="nav-link"><i class="fas fa-chart-line"></i> Analytics</a>
        </nav>
    </header>
    <div class="container">
        <section class="bus-status">
            <div class="section-header">
                <h2>Bus Status</h2>
            </div>
            <div id="busTableContainer">
                {% if buses %}
                <!-- Your dynamic table rendering here -->
                {% else %}
                <p class="no-data">No bus data available yet. Scan a QR code to start tracking!</p>
                {% endif %}
            </div>
        </section>
        <!-- BOOK AUTO SECTION -->
        <section class="auto-section">
            <div class="section-header">
                <h2><i class="fas fa-taxi"></i> Book Auto (Campus)</h2>
            </div>
            <div id="autoList" class="auto-list">
                <div class="loader"></div>
            </div>
        </section>
        <!-- CAMPUS MAP SECTION -->
        <section class="map-section">
            <div class="section-header">
                <h2>Campus Map</h2>
            </div>
            <iframe id="mapFrame" src="{{ url_for('static', filename='map.html') }}" width="100%" height="600"
                style="border:0; background: #eee; margin-bottom: 2em;" title="Campus Map" allowfullscreen
                loading="lazy"></iframe>
        </section>
    </div>

    <!-- QR Code Popup Modal -->
    <div id="qrModal" class="modal">
        <div class="modal-content">
            <img id="enlargedQR" src="" alt="QR Code">
            <br>
            <button aria-label="Close modal" onclick="closeModal()">Close</button>
        </div>
    </div>
    <!-- Bus Details Modal -->
    <div id="busDetailModal" class="modal">
        <div class="modal-content" id="busDetailsContent">
            <button aria-label="Close modal" onclick="closeBusDetailModal()">Close</button>
        </div>
    </div>
    <!-- Auto Booking Modal -->
    <div id="autoModal" class="modal">
        <div class="modal-content">
            <div id="autoModalDetails">Booking Auto ...</div>
            <form id="autoBookingForm" style="margin-top:1em;">
                <input type="hidden" id="autoIdField" name="autoId" />
                <label>Pickup Location: <input type="text" name="pickupLocation" required></label><br><br>
                <label>Drop Location: <input type="text" name="dropLocation" required></label><br><br>
                <label>Your Phone: <input type="text" name="phone" required></label><br><br>
                <button type="submit">Confirm Booking</button>
            </form>
            <button aria-label="Close modal" id="closeAutoModalBtn" type="button"
                style="margin-top:3em;">Cancel</button>
        </div>

    </div>
    <footer>
        <p>&copy; 2025 SmartStop VIT | Developed for VIT Campus Shuttle System</p>
    </footer>
    <!-- Snackbar notification -->
    <div id="snackbar" class="snackbar">Saved!</div>
    <script>
        function showSnackbar(msg) {
            var sb = document.getElementById('snackbar');
            sb.textContent = msg;
            sb.className = 'snackbar show';
            setTimeout(() => { sb.className = 'snackbar'; }, 3000);
        }
    </script>
    <!-- Dark Mode logic at end so all DOM is present -->
    <script>
        (function () {
            const darkBtn = document.getElementById('darkModeSwitch');
            function updateDarkButton() {
                if (document.body.classList.contains('dark-mode')) {
                    darkBtn.innerHTML = '<i class="fas fa-sun"></i> Light Mode';
                } else {
                    darkBtn.innerHTML = '<i class="fas fa-moon"></i> Dark Mode';
                }
            }
            if (localStorage.getItem('dark') === 'true') {
                document.body.classList.add('dark-mode');
            }
            updateDarkButton();
            darkBtn.onclick = function () {
                document.body.classList.toggle('dark-mode');
                const dark = document.body.classList.contains('dark-mode');
                localStorage.setItem('dark', dark ? 'true' : 'false');
                updateDarkButton();
            }
        })();
    </script>
</body>

</html>